## Swagger (OpenAPI) Setup Guide

This project is configured to serve Swagger UI at `/api/documentation`.

You can document APIs using either:

-   YAML source (`openapi.yaml`) [current mode], or
-   PHP annotations (L5-Swagger generator) [optional]

### 0) Requirements

-   PHP 8.2+
-   Laravel 12
-   Package: `darkaonline/l5-swagger` (installed)

### 1) View the Docs (YAML mode)

1. Start the server.
    - Windows PowerShell:
        ```bash
        php artisan serve
        ```
2. Open the UI:
    - `http://127.0.0.1:8000/api/documentation`

### 2) Where the UI reads the spec from

-   Config: `config/l5-swagger.php`
    -   `documentations.default.paths.format_to_use_for_docs: yaml`
    -   Generated spec path (used by the UI): `storage/api-docs/api-docs.yaml`

### 3) Edit the API spec

-   Primary source file: `openapi.yaml` (project root)

After editing `openapi.yaml`, copy it for the UI:

```powershell
mkdir storage\api-docs -Force
Copy-Item -Path openapi.yaml -Destination storage\api-docs\api-docs.yaml -Force
```

Then refresh `http://127.0.0.1:8000/api/documentation`.

### 4) Securing endpoints in the spec

-   User endpoints use: `bearerAuth`
-   Admin endpoints use: `adminAuth`
-   Both are defined under `components.securitySchemes` in `openapi.yaml`.

### 5) Optional: Use annotations and auto-generate

If you prefer generating the spec from PHPDoc annotations:

1. Switch UI to read JSON generated by L5-Swagger:
    - In `config/l5-swagger.php`, set:
        - `documentations.default.paths.format_to_use_for_docs` = `json`
2. Add `@OA\...` annotations above controller actions.
3. Generate the docs file:
    ```bash
    php artisan l5-swagger:generate
    ```
4. Open: `http://127.0.0.1:8000/api/documentation`

Tip: You can keep `openapi.yaml` for shared schemas and still annotate endpoints. Choose a single source of truth to avoid drift.

### 6) Common commands

```bash
# Clear caches (if UI doesn’t update)
php artisan config:clear
php artisan cache:clear

# Publish L5-Swagger assets (already done)
php artisan vendor:publish --provider "L5Swagger\L5SwaggerServiceProvider" --tag="config"
php artisan vendor:publish --provider "L5Swagger\L5SwaggerServiceProvider" --tag="views"
```

### 7) Troubleshooting

-   UI loads but no endpoints:
    -   YAML mode: ensure `storage/api-docs/api-docs.yaml` exists and is valid YAML.
    -   Annotations mode: ensure files with `@OA` are within `paths.annotations` (by default `app/`).
-   “Required @OA\PathItem() not found” on generation:
    -   You have no annotated paths; either add annotations or use YAML mode.
-   Auth buttons not showing:
    -   Check `components.securitySchemes` and operation `security` blocks in the spec.

### 8) Quick YAML workflow (recommended)

1. Edit `openapi.yaml`
2. Copy to UI path:

```powershell
Copy-Item -Path openapi.yaml -Destination storage\api-docs\api-docs.yaml -Force
```

3. Refresh `/api/documentation`
